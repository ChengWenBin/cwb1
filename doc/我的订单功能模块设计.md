# 我的订单功能模块设计

## 1. 功能描述

我的订单功能模块主要实现对用户个人订单的管理，重点是订单状态查看、支付和取消功能。主要功能包括：

- 订单列表查看：支持查看个人所有订单，显示订单编号、下单时间、总金额、收货地址和订单状态等信息
- 订单详情查看：支持查看订单基本信息、商品信息、收货信息等
- 订单状态管理：支持订单支付和取消操作
- 订单备注功能：支持为订单添加个人备注信息

## 2. 详细设计

### (1) 功能组件表

我的订单功能组件表如表 1 所示。

表 1 我的订单功能组件表

| 功能层次 | 类或页面 | 方法或请求 | 说明 |
| --- | --- | --- | --- |
| View | userOrder.vue | handlePay()、handleCancel()、handleDetail() | 处理订单支付、取消和详情查看 |
| Controller | OrderController | listMyOrder()、updateOrder()、cancelOrder() | 查询订单列表、更新订单状态、取消订单 |
| Service | OrderService | selectMyOrderList()、updateOrder() | 查询订单列表、订单状态更新业务处理 |
| Mapper | OrderMapper | selectOrderList()、updateOrder() | 查询订单数据、更新订单数据 |
| Domain | Order | get/set | 订单实体类（包含OrderItem订单项） |

### (2) 类的调用时序模型

订单支付时序模型如图 1 所示。

```
+--------+    +--------+    +--------+    +--------+    +--------+    +--------+
|        |    |        |    |        |    |        |    |        |    |        |
| 用户    |    |userOrder|    |Order   |    |Order   |    |Order   |    |Order   |
|        |    |.vue    |    |Control.|    |Service |    |Mapper  |    |        |
+--------+    +--------+    +--------+    +--------+    +--------+    +--------+
    |             |             |             |             |             |
    | 点击支付按钮  |             |             |             |             |
    |------------>|             |             |             |             |
    |             |             |             |             |             |
    |             | confirmPay()|             |             |             |
    |             |------------>|             |             |             |
    |             |             |             |             |             |
    |             |             | updateOrder()|             |             |
    |             |             |------------>|             |             |
    |             |             |             |             |             |
    |             |             |             | updateOrder()|             |
    |             |             |             |------------>|             |
    |             |             |             |             |             |
    |             |             |             |             | get/set     |
    |             |             |             |             |------------>|
    |             |             |             |             |             |
    |             |             |             |             |<------------|
    |             |             |             |             | return      |
    |             |             |             |<------------| return      |
    |             |             |             | return      |             |
    |             |             |<------------| return      |             |
    |             |             | return      |             |             |
    |             |<------------| return      |             |             |
    |             | return      |             |             |             |
    |<------------| return      |             |             |             |
    |             |             |             |             |             |
```

订单取消时序模型如图 2 所示。

```
+--------+    +--------+    +--------+    +--------+    +--------+    +--------+
|        |    |        |    |        |    |        |    |        |    |        |
| 用户    |    |userOrder|    |Order   |    |Order   |    |Order   |    |Order   |
|        |    |.vue    |    |Control.|    |Service |    |Mapper  |    |        |
+--------+    +--------+    +--------+    +--------+    +--------+    +--------+
    |             |             |             |             |             |
    | 点击取消按钮  |             |             |             |             |
    |------------>|             |             |             |             |
    |             |             |             |             |             |
    |             | handleCancel()|           |             |             |
    |             |------------>|             |             |             |
    |             |             |             |             |             |
    |             |             | cancelOrder()|             |             |
    |             |             |------------>|             |             |
    |             |             |             |             |             |
    |             |             |             | cancelOrder()|             |
    |             |             |             |------------>|             |
    |             |             |             |             |             |
    |             |             |             |             | get/set     |
    |             |             |             |             |------------>|
    |             |             |             |             |             |
    |             |             |             |             |<------------|
    |             |             |             |             | return      |
    |             |             |             |<------------| return      |
    |             |             |             | return      |             |
    |             |             |<------------| return      |             |
    |             |             | return      |             |             |
    |             |<------------| return      |             |             |
    |             | return      |             |             |             |
    |<------------| return      |             |             |             |
    |             |             |             |             |             |
```

### (3) 执行流程描述

1. 订单列表查看流程
   - 用户登录系统后，访问我的订单页面
   - 系统调用 listMyOrder() 接口获取当前用户的所有订单
   - 系统展示订单列表，包括订单编号、下单时间、总金额、收货地址和订单状态等信息
   - 用户可以通过订单状态标签直观了解订单当前状态（待付款、待发货、已发货、已完成、已取消）

2. 订单详情查看流程
   - 用户点击订单列表中的详情按钮
   - 系统调用 selectOrderById() 接口获取订单详细信息
   - 系统调用 listOrderItem() 接口获取订单商品信息
   - 系统展示订单详情对话框，显示订单基本信息（订单编号、下单时间、总金额等）
   - 系统展示订单商品信息（产品ID、产品名称、购买数量、单价、总价等）

3. 订单支付流程
   - 用户点击待付款订单的支付按钮
   - 系统弹出确认支付对话框
   - 用户确认支付
   - 系统调用 updateOrder() 接口更新订单状态为待发货
   - 系统刷新订单列表，显示最新订单状态

4. 订单取消流程
   - 用户点击待付款订单的取消按钮
   - 系统弹出确认取消对话框
   - 用户确认取消
   - 系统调用 cancelOrder() 接口取消订单
   - 系统刷新订单列表，显示最新订单状态

5. 订单备注流程
   - 用户点击订单的备注按钮
   - 系统弹出备注对话框，显示当前备注内容（如有）
   - 用户输入或修改备注内容
   - 用户确认提交
   - 系统调用 updateOrder() 接口更新订单备注
   - 系统刷新订单列表，备注信息更新成功