# 购物车模块设计

## 1. 功能描述

购物车模块主要实现对用户选购商品的临时存储和管理，重点是商品选择和数量管理功能。主要功能包括：

- 商品管理：支持添加商品到购物车、修改商品数量、删除商品、清空购物车
- 商品选择：支持单个商品选择、全选/取消全选功能
- 价格计算：实时计算选中商品的总价和数量
- 库存校验：添加商品时自动校验库存数量

## 2. 详细设计

### (1) 功能组件表

购物车功能组件表如表 1 所示。

表 1 购物车功能组件表

| 功能层次 | 类或页面 | 方法或请求 | 说明 |
| --- | --- | --- | --- |
| View | cart.vue | handleCartItem() | 处理购物车商品操作 |
| Controller | CartController | updateCartItem() | 更新购物车商品 |
| Service | CartService | updateItem() | 购物车商品业务处理 |
| Mapper | CartMapper | updateCart() | 数据库操作 |
| Domain | Cart | get/set | 购物车实体类 |

### (2) 类的调用时序模型

购物车商品管理时序模型如图 1 所示。

```
+--------+    +--------+    +--------+    +--------+    +--------+    +--------+
|        |    |        |    |        |    |        |    |        |    |        |
| 用户    |    |cart    |    |Cart    |    |Cart    |    |Cart    |    |Cart    |
|        |    |.vue    |    |Control.|    |Service |    |Mapper  |    |        |
+--------+    +--------+    +--------+    +--------+    +--------+    +--------+
    |             |             |             |             |             |
    | 访问         |             |             |             |             |
    |------------>|             |             |             |             |
    |             |             |             |             |             |
    |             | handleItem  |             |             |             |
    |             |------------>|             |             |             |
    |             |             |             |             |             |
    |             |             | updateItem  |             |             |
    |             |             |------------>|             |             |
    |             |             |             |             |             |
    |             |             |             | update      |             |
    |             |             |             |------------>|             |
    |             |             |             |             |             |
    |             |             |             |             | get/set     |
    |             |             |             |             |------------>|
    |             |             |             |             |             |
    |             |             |             |             |<------------|
    |             |             |             |             | return      |
    |             |             |             |<------------| return      |
    |             |             |             | return      |             |
    |             |             |<------------| return      |             |
    |             |             | return      |             |             |
    |             |<------------| return      |             |             |
    |             | return      |             |             |             |
    |<------------| return      |             |             |             |
    |             |             |             |             |             |
```

### (3) 执行流程描述

1. 添加商品到购物车流程
   - 点击添加到购物车按钮
   - 校验商品库存数量
   - 调用 handleCartItem() 函数处理商品数据
   - 调用 updateCartItem() 接口保存购物车数据
   - 调用 updateCart() 方法更新数据库
   - 保存成功后刷新购物车列表

2. 修改商品数量流程
   - 点击增加/减少按钮或直接输入数量
   - 校验输入数量是否超过库存
   - 调用相关接口更新商品数量
   - 实时计算商品总价

3. 商品选择流程
   - 支持单个商品选择/取消
   - 支持全选/取消全选
   - 实时更新选中商品数量和总价
   - 选中状态持久化保存
