<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.shop.system.mapper.DashboardMapper">

    <select id="getSalesTrend" resultType="map">
        SELECT DATE(create_time) AS date, SUM(total_amount) AS sales
        FROM `order`
        WHERE order_status != '已取消'
        GROUP BY DATE(create_time)
        ORDER BY DATE(create_time)
    </select>

    <select id="getProductSales" resultType="map">
        SELECT
            CASE p.category
                WHEN '电脑' THEN '电脑'
                WHEN '手机' THEN '手机'
                WHEN '平板' THEN '平板'
                WHEN '耳机' THEN '耳机'
                ELSE '其他'
                END AS category,
            SUM(oi.total_price) AS sales
        FROM order_item oi
                 JOIN product p ON oi.product_id = p.id
                 JOIN `order` o ON oi.order_id = o.order_id
        WHERE o.order_status != '已取消'
        GROUP BY category
    </select>

    <select id="getOrderTrend" resultType="map">
        SELECT DATE(create_time) AS date, COUNT(*) AS orderCount
        FROM `order`
        GROUP BY DATE(create_time)
        ORDER BY DATE(create_time)
    </select>

    <select id="getOrderStatus" resultType="map">
        SELECT order_status AS status, COUNT(*) AS count
        FROM `order`
        GROUP BY order_status
    </select>

    <select id="getSalesReportTotalSales" resultType="map">
        SELECT SUM(total_amount) as totalSales FROM `order` WHERE order_status != '已取消'
    </select>
    <select id="getSalesReportProductSales" resultType="map">
        SELECT p.name, SUM(oi.quantity) AS quantity, SUM(oi.total_price) AS amount
        FROM order_item oi
                 JOIN product p ON oi.product_id = p.id
                 JOIN `order` o ON oi.order_id = o.order_id
        WHERE o.order_status != '已取消'
        GROUP BY p.name
    </select>

    <select id="getSalesReportDailySales" resultType="map">
        SELECT DATE(create_time) AS date, SUM(total_amount) AS amount
        FROM `order`
        WHERE order_status != '已取消'
        GROUP BY DATE(create_time)
        ORDER BY DATE(create_time)
    </select>

    <select id="getOrderReport" resultType="map">
        SELECT create_time, user_id, order_no, order_status, total_amount, address
        FROM `order`
        ORDER BY create_time DESC
    </select>

</mapper>